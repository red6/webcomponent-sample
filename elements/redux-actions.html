<script>
    (function() {
        function requestTasks(url) {
            return {
                type: 'TASK_LOADING_STARTED',
                url,
            };
        }

        function receiveTasks(url, json) {
            return {
                type: 'TASK_LOADING_COMPLETED',
                url,
                items: Array.from(json),
                receivedAt: Date.now()
            };
        }

        function openTask(idx) {
            return {
                type: 'OPEN_TASK',
                itemIdx: idx,
            };
        }

        function fetchTasks(url) {
            return (dispatch) => {
                dispatch(requestTasks());
                fetch(url, {})
                    .then((response) => {
                        return response.json();
                    })
                    .then((json) => { dispatch(receiveTasks(url, json));} );
            };
        }

        TaskView.actions = {
            fetchTasks,
            openTask
        };
    }());
</script>
