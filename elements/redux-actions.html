<script>
    (function() {
        function requestTasks(url) {
            return {
                type: 'TASK_LOADING_STARTED',
                url,
            };
        }

        function receiveTasks(url, json) {
            return {
                type: 'TASK_LOADING_COMPLETED',
                url,
                tasks: Array.from(json),
                receivedAt: Date.now()
            };
        }

        function fetchTasks(url) {
            return (dispatch) => {
                dispatch(requestTasks());
                fetch(url, {})
                    .then((response) => {
                        return response.json();
                    })
                    .then((json) => { dispatch(receiveTasks(url, json));
                    console.log('BLB ' + json);
                } )
                    .catch( (error) => {
                        dispatch({
                            type: 'TASK_LOADING_ERROR',
                        });
                    } );
            };
        }

        TaskView.actions = {
            fetchTasks
        };
    }());
</script>
